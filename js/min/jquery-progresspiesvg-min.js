/**
 * @license 
 * Copyright (c) 2016, Immo Schulz-Gerlach, www.isg-software.de 
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are 
 * permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT 
 * SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, 
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED 
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; 
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
!function($){"use strict";var e="$.fn.setupProgressPie";$.fn.setupProgressPie=function(t){return $(this).each(function(){var r=$(this).data(e);if("object"!=typeof r){var n=$.extend({},$.fn.progressPie.defaults,{update:!0},t);$(this).data(e,n)}else $.extend(r,t)}),this},$.fn.progressPie=function(t){function r(e){return.02*Math.PI*e}function n(e,t){var r=eval,n=r(e);if("function"==typeof n)return n(t);throw"The value of the colorFunctionAttr attribute is NOT a function: "+e}function o(e){var t=eval,r=t(A+"."+e);if("function"==typeof r||"object"==typeof r&&"function"==typeof r.draw)return r;throw e+" is not the name of a function or object in namespace "+A+"!"}function i(e){var t;if("function"==typeof e||"object"==typeof e&&"function"==typeof e.draw)t=e;else{if("string"!=typeof e)throw"contentPlugin option must either be a function or an object with method named 'draw' or the name of such a function or object in the namespace "+A+"!";t=o(e)}return t}function a(e){return Array.isArray(e)?$.map(e,i):[i(e)]}function s(e,t){return null===e?null:Array.isArray(e)?e[t]:0===t&&"object"==typeof e?e:null}function u(e,t){return.02*Math.PI*e*t}function l(e,t,r,n,o,i){var a=document.createElementNS(b,"animate");a.setAttribute("attributeName",t),a.setAttribute("attributeType",r),a.setAttribute("from",n),a.setAttribute("to",o),a.setAttribute("fill","freeze");for(var s in i)a.setAttribute(s,i[s]);e.appendChild(a)}function f(e,t,r){var n,o;if("number"==typeof t)n=t;else{if("object"!=typeof t)throw"illegal option: 'strokeDashes' is neither number (count) nor object!";n=t.count,o=t.length}if("undefined"==typeof n)throw"illegal option: 'strokeDashes' does not specify the 'count' property!";if("undefined"==typeof o)o=r/n/2;else if("string"==typeof o){o=o.trim();var i="%"===o.substring(o.length-1);o=Number.parseInt(o,10),i&&(o=r*o/100)}if(o*n>=r)throw"Illegal options: strokeDashCount * strokeDashLength >= circumference, can't set stroke-dasharray!";var a=(r-o*n)/n,s="object"==typeof t&&t.centered?1*o/2:0;"object"==typeof t&&t.inverted?(e.style.strokeDasharray=""+a+"px, "+o+"px",e.style.strokeDashoffset=""+(a+s)+"px"):(e.style.strokeDasharray=""+o+"px, "+a+"px",0!==s&&(e.style.strokeDashoffset=""+s+"px"))}function p(e,t,n,o,i,a,s,p,d,c,g,y,h,m,v,A){"number"==typeof n&&(n=Math.min(n,t)),"number"==typeof s&&(s=Math.min(s,t));var C,S,P=!1;if("number"==typeof n){S=document.createElementNS(b,"circle"),S.setAttribute("cx",0),S.setAttribute("cy",0),C=t-n/2,S.setAttribute("r",C),S.setAttribute("transform","rotate(-90)"),i&&f(S,i,2*Math.PI*C),P="string"==typeof o;var k=P?o:h;"string"==typeof k&&(S.style.stroke=k,S.style.fill="none"),S.style.strokeWidth=n,S.setAttribute("class",d),e.appendChild(S)}var E=s?s:a||"number"!=typeof n?t:t-n;if(C=t-E/2,a||"number"!=typeof n||(C-=n),100!==g||v||"string"!=typeof h){if(g>0&&g<100||(v||"undefined"==typeof h)&&(0===g||100===g)){var R=document.createElementNS(b,"path"),w,N=g;if(v){var x=g-y,O=u(C,x),D=x<0,M,F;D?(N=y,M="0px",F=-O+"px"):(M=O+"px",F="0px");var _=u(C,N);R.setAttribute("stroke-dasharray",_+"px "+_+"px"),R.setAttribute("stroke-dashoffset",M),l(R,"stroke-dashoffset","CSS",M,F,v),p&&0===g&&l(R,"stroke-linecap","CSS","round","butt",v),m&&m!==h&&(l(R,"stroke","CSS",m,h,v),P||(S.style.stroke=m,l(S,"stroke","CSS",m,h,v)))}var j=r(N),B=100===N?-1e-5:Math.sin(j)*C,T=Math.cos(j-Math.PI)*C,z=N>50?"1":"0",I="1",W=-C,V="M0,"+W;if(V+=" A"+C+","+C+" 0 "+z+","+I+" "+B+","+T,R.setAttribute("d",V),R.style.fill="none","string"==typeof h&&(R.style.stroke=h),R.style.strokeWidth=E,R.style.strokeLinecap=p&&g>0?"round":"butt",A){var U=A.clockwise===!1,L="string"==typeof A?A:"string"==typeof A.duration?A.duration:"1s";w=document.createElementNS(b,"animateTransform"),w.setAttribute("attributeName","transform"),w.setAttribute("attributeType","XML"),w.setAttribute("type","rotate"),w.setAttribute("from","0"),w.setAttribute("to",U?"-360":"360"),w.setAttribute("dur",L),w.setAttribute("repeatDur","indefinite"),R.appendChild(w)}R.setAttribute("class",c),e.appendChild(R)}}else{var G=document.createElementNS(b,"circle");G.setAttribute("cx",0),G.setAttribute("cy",0),G.setAttribute("r",C),G.style.stroke=h,G.style.strokeWidth=E,G.style.fill="none",G.setAttribute("class",c),e.appendChild(G)}}function d(e,t){var r;if("string"==typeof t.valueData){if(r=e.data(t.valueData),"undefined"!=typeof t.valueAttr||"undefined"!=typeof t.valueSelector)throw"options 'valueData', 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least two must be undefined!"}else{if("undefined"!=typeof t.valueData)throw"option 'valueData' is not of type 'string'!";if("string"==typeof t.valueAttr){if(r=e.attr(t.valueAttr),"undefined"!=typeof t.valueSelector)throw"options 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least one must be undefined!"}else{if("undefined"!=typeof t.valueAttr)throw"option 'valueAttr' is not of type 'string'!";"undefined"!=typeof t.valueSelector&&(r=$(t.valueSelector,e).text())}}return"undefined"==typeof r&&(r=e.text()),r}function c(e,t){return Math.max(0,Math.min(100,t.valueAdapter(e)))}function g(e,t){var r=t.mode,n=t.color,o=typeof n;if("undefined"!==o&&"string"!==o&&"function"!==o)throw"option 'color' has to be either a function or a string, but is of type '"+o+"'!";return"function"===o?r=S.USER_COLOR_FUNC:("undefined"===o&&"string"==typeof t.colorAttr&&(n=e.attr(t.colorAttr)),"string"==typeof n?r=S.USER_COLOR_CONST:"string"==typeof t.colorFunctionAttr&&(n=e.attr(t.colorFunctionAttr),"string"==typeof n&&(r=S.DATA_ATTR_FUNC))),{mode:r,color:n}}function y(e,t,r){return e===S.CSS?void 0:e===S.GREY?S.GREY.color:e===S.GREEN?C.colorByPercent(100):e===S.RED?C.colorByPercent(0):e===S.COLOR||void 0===t?C.colorByPercent(r):e===S.USER_COLOR_CONST?t:e===S.USER_COLOR_FUNC?t(r):e===S.DATA_ATTR_FUNC?n(t,r):"black"}function h(e,t){return"undefined"==typeof e.ringWidth||t&&t.fullSize}var m=$.extend({},$.fn.progressPie.defaults,t),v="undefined"==typeof t,b="http://www.w3.org/2000/svg",A="jQuery.fn.progressPie.contentPlugin",C=$.fn.progressPie,S=$.extend({USER_COLOR_CONST:{},USER_COLOR_FUNC:{},DATA_ATTR_FUNC:{}},C.Mode);return $(this).each(function(){var t=$(this),r=m;if(v){var n=$(this).data(e);"object"==typeof n&&(r=n)}var o=$("svg",t);if(!o.length||r.update){o.length&&r.update&&(o.remove(),r.separator="");var u=d(t,r),l=c(u,r),f=t.data($.fn.progressPie.prevValueDataName),A="undefined"==typeof f;if(t.data($.fn.progressPie.prevValueDataName,l),"number"!=typeof f&&(f=0),"function"==typeof r.optionsByPercent){var C=r.optionsByPercent(l);"undefined"!=typeof C&&null!==C&&(r=$.extend({},r,C),u=d(t,r),l=c(u,r))}var S=g(t,r),P=Math.ceil("number"==typeof r.size?r.size:t.height());0===P&&(P=20),P*=r.sizeFactor;var k=P/2,E=k,R=E,w=document.createElementNS(b,"svg"),N=document.createElementNS(b,"defs"),x=P;"number"==typeof r.scale&&(x*=r.scale),w.setAttribute("width",Math.ceil(x)),w.setAttribute("height",Math.ceil(x)),w.setAttribute("viewBox","-"+E+" -"+E+" "+P+" "+P),S.mode!==$.fn.progressPie.Mode.CSS&&(w.style.verticalAlign=r.verticalAlign),t.is(":empty")?t.append(w):r.prepend?t.prepend(w,r.separator):t.append(r.separator,w);var O=r.cssClassForegroundPie,D=r.cssClassBackgroundCircle;"object"==typeof r.inner&&(O+=" "+r.cssClassOuter,D+=" "+r.cssClassOuter);var M=y(S.mode,S.color,l),F;(r.animateColor===!0||"undefined"==typeof r.animateColor&&!A)&&(F=y(S.mode,S.color,f));var _=$.fn.progressPie.smilSupported()?r.animate===!0?$.fn.progressPie.defaultAnimationAttributes:"object"==typeof r.animate?$.extend({},$.fn.progressPie.defaultAnimationAttributes,r.animate):null:null,j,B=!1;if(r.contentPlugin){j=a(r.contentPlugin);for(var T={color:M,percentValue:l,rawValue:u,pieOpts:r},z=0;z<j.length;z++){var I=j[z],W=s(r.contentPluginOptions,z),V=T;null!==W&&"object"==typeof W&&(V=$.extend({},T,W)),"object"==typeof I&&"function"==typeof I.hidesChartIfFullSize&&(B=B||h(r,W)&&I.hidesChartIfFullSize(V))}}B||p(w,E,r.strokeWidth,r.strokeColor,r.strokeDashes,r.overlap,r.ringWidth,r.ringEndsRounded,D,O,l,f,M,F,_,r.rotation);for(var U="number"==typeof r.ringWidth?r.ringWidth:"number"==typeof r.strokeWidth?r.strokeWidth:0,L=r.inner,G=1;"object"==typeof L;){"undefined"==typeof L.valueAdapter&&(L.valueAdapter=$.fn.progressPie.defaults.valueAdapter),"undefined"==typeof L.overlap&&(L.overlap=$.fn.progressPie.defaults.overlap),u=d(t,L),l=c(u,L);var Y=$.fn.progressPie.prevInnerValueDataName,Q=r.cssClassInner;G>1&&(Y+=G,Q+=G),f=t.data(Y),A="undefined"==typeof f,t.data(Y,l),"number"!=typeof f&&(f=0),S=g(t,L),E="number"==typeof L.size?L.size*r.sizeFactor/2:.6*E,M=y(S.mode,S.color,l),F=null,(L.animateColor===!0||"undefined"==typeof L.animateColor&&(r.animateColor===!0||"undefined"==typeof r.animateColor&&A))&&(F=y(S.mode,S.color,f)),L.animate!==!1&&$.fn.progressPie.smilSupported()?L.animate===!0&&null===_?_=$.fn.progressPie.defaultAnimationAttributes:"object"==typeof L.animate&&(_=null===_?$.extend({},$.fn.progressPie.defaultAnimationAttributes,L.animate):$.extend({},_,L.animate)):_=null,B||p(w,E,L.strokeWidth,L.strokeColor,L.strokeDashes,L.overlap,L.ringWidth,L.ringEndsRounded,r.cssClassBackgroundCircle+" "+Q,r.cssClassForegroundPie+" "+Q,l,f,M,F,_),U="number"==typeof L.ringWidth?L.ringWidth:0,L=L.inner,G++}if(j){var X=E;U<E&&(X-=U);for(var q={newSvgElement:function(e){var t=document.createElementNS(b,e);return K.appendChild(t),t},newSvgSubelement:function(e,t){var r=document.createElementNS(b,t);return e.appendChild(r),r},newDefElement:function(e){var t=document.createElementNS(b,e);return N.appendChild(t),t},isFullSize:function(){return h(r,this)},getBackgroundRadius:function(e){var t=this.isFullSize()?this.totalRadius:this.radius;if(!e){var r="number"==typeof this.margin?this.margin:this.isFullSize()?this.pieOpts.defaultContentPluginBackgroundMarginFullSize:this.pieOpts.defaultContentPluginBackgroundMarginInsideRing;t-=r}return t},addBackground:function(e){if(this.backgroundColor){var t=this.newSvgElement("circle");t.setAttribute("cx","0"),t.setAttribute("cy","0"),t.setAttribute("r",e),t.setAttribute("fill",this.backgroundColor)}},getContentPlugin:i,radius:X,totalRadius:R,color:M,percentValue:l,rawValue:u,pieOpts:r},H=0;H<j.length;H++){var J=j[H],K=document.createElementNS(b,"g"),Z="function"==typeof J?J:J.draw,ee=q,te=s(r.contentPluginOptions,H);null!==te&&"object"==typeof te&&(ee=$.extend({},q,te)),Z(ee),"boolean"==typeof J.inBackground&&J.inBackground||"function"==typeof J.inBackground&&J.inBackground(ee)?w.prepend(K):w.append(K),N.hasChildNodes()&&w.prepend(N)}}}}),this},$.fn.progressPie.Mode={GREY:{color:"#888"},RED:{value:200},GREEN:{value:200},COLOR:{},CSS:{}},$.fn.progressPie.colorByPercent=function(e){var t=$.fn.progressPie.Mode.GREEN.value,r=$.fn.progressPie.Mode.RED.value,n=e>50?t:Math.floor(t*e/50),o=e<50?r:Math.floor(r*(100-e)/50);return"rgb("+o+","+n+",0)"},$.fn.progressPie.smilSupported=function(){return"undefined"==typeof $.fn.progressPie.smilSupported.cache&&($.fn.progressPie.smilSupported.cache=/SVGAnimate/.test(document.createElementNS("http://www.w3.org/2000/svg","animate").toString())),$.fn.progressPie.smilSupported.cache},$.fn.progressPie.defaults={mode:$.fn.progressPie.Mode.GREY,strokeWidth:2,overlap:!0,prepend:!0,separator:"&nbsp;",verticalAlign:"bottom",update:!1,valueAdapter:function(e){return"string"==typeof e?parseFloat(e):"number"==typeof e?e:0},ringEndsRounded:!1,sizeFactor:1,scale:1,defaultContentPluginBackgroundMarginFullSize:0,defaultContentPluginBackgroundMarginInsideRing:1,cssClassBackgroundCircle:"progresspie-background",cssClassForegroundPie:"progresspie-foreground",cssClassOuter:"progresspie-outer",cssClassInner:"progresspie-inner"},$.fn.progressPie.defaultAnimationAttributes={dur:"1s",calcMode:"spline",keySplines:"0.23 1 0.32 1",keyTimes:"0;1"},$.fn.progressPie.contentPlugin={},$.fn.progressPie.prevValueDataName="_progresspieSVG_prevValue",$.fn.progressPie.prevInnerValueDataName="_progresspieSVG_prevInnerValue"}(jQuery);
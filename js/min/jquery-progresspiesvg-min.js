/**
 * @license 
 * Copyright (c) 2016, Immo Schulz-Gerlach, www.isg-software.de 
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are 
 * permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT 
 * SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, 
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED 
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; 
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
!function($){"use strict";var e="$.fn.setupProgressPie",t={};$.fn.setupProgressPie=function(t){return $(this).each(function(){var n=$(this).data(e);if("object"!=typeof n){var r=$.extend({},$.fn.progressPie.defaults,{update:!0},t);$(this).data(e,r)}else $.extend(n,t)}),this},$.fn.progressPie=function(n){function r(e,t){if("number"==typeof e)return e;if(Array.isArray(e)&&e.length>0){if(1===e.length)return e[0];for(var n=t;n>=e.length;)n-=2;return e[n]}return 0}function o(e){return"undefined"==typeof t[e]&&(t[e]=0),e+ ++t[e]}function i(e){return.02*Math.PI*e}function a(e,t){var n=eval,r=n(e);if("function"==typeof r)return r(t);throw"The value of the colorFunctionAttr attribute is NOT a function: "+e}function s(e){var t=eval,n=t(E+"."+e);if("function"==typeof n||"object"==typeof n&&"function"==typeof n.draw)return n;throw e+" is not the name of a function or object in namespace "+E+"!"}function u(e){var t;if("function"==typeof e||"object"==typeof e&&"function"==typeof e.draw)t=e;else{if("string"!=typeof e)throw"contentPlugin option must either be a function or an object with method named 'draw' or the name of such a function or object in the namespace "+E+"!";t=s(e)}return t}function l(e){return Array.isArray(e)?$.map(e,u):[u(e)]}function d(e,t){return null===e?null:Array.isArray(e)?e[t]:0===t&&"object"==typeof e?e:null}function f(e,t){return.02*Math.PI*e*t}function p(e,t,n,r,o,i){var a=document.createElementNS(R,"animate");a.setAttribute("attributeName",t),a.setAttribute("attributeType",n),a.setAttribute("from",r),a.setAttribute("to",o),a.setAttribute("fill","freeze");for(var s in i)a.setAttribute(s,i[s]);e.appendChild(a)}function c(e,t,n){var r,o;if("number"==typeof t)r=t;else{if("object"!=typeof t)throw"illegal option: 'strokeDashes' is neither number (count) nor object!";r=t.count,o=t.length}if("undefined"==typeof r)throw"illegal option: 'strokeDashes' does not specify the 'count' property!";if("undefined"==typeof o)o=n/r/2;else if("string"==typeof o){o=o.trim();var i="%"===o.substring(o.length-1);o=Number.parseInt(o,10),i&&(o=n*o/100)}if(o*r>=n)throw"Illegal options: strokeDashCount * strokeDashLength >= circumference, can't set stroke-dasharray!";var a=(n-o*r)/r,s="object"==typeof t&&t.centered?1*o/2:0;"object"==typeof t&&t.inverted?(e.style.strokeDasharray=""+a+"px, "+o+"px",e.style.strokeDashoffset=""+(a+s)+"px"):(e.style.strokeDasharray=""+o+"px, "+a+"px",0!==s&&(e.style.strokeDashoffset=""+s+"px"))}function g(e,t,n,r,o,a,s,u,l,d,g,m,h,y,b,A,v,S){"number"==typeof n&&(n=Math.min(n,t)),"number"==typeof u&&(u=Math.min(u,t));var C=-1;if("number"==typeof n&&"number"==typeof u&&n>0&&u>0&&n!==u&&s&&(d===N.RingAlign.CENTER||d===N.RingAlign.INNER)){var k=Math.max(u,n),P=Math.min(u,n);C=d===N.RingAlign.CENTER?t-k/2:t-k+P/2}var M,E,w=!1;if("number"==typeof n){E=document.createElementNS(R,"circle"),E.setAttribute("cx",0),E.setAttribute("cy",0),C>0&&n<u?M=C:(M=t-n/2,s||d!==N.RingAlign.INNER||(M-=u)),E.setAttribute("r",M),E.setAttribute("transform","rotate(-90)"),o&&c(E,o,2*Math.PI*M),w="string"==typeof r;var x=w?r:b;"string"==typeof x&&(E.style.stroke=x),"string"==typeof a&&(E.style.fill=a),E.style.strokeWidth=n,E.setAttribute("class",g),e.appendChild(E)}var O=u?u:s||"number"!=typeof n?t:t-n;if(C>0&&u<n?M=C:(M=t-O/2,s||"number"!=typeof n||d!==N.RingAlign.OUTER||(M-=n)),100!==h||v||"string"!=typeof b){if(h>0&&h<100||(v||"undefined"==typeof b)&&(0===h||100===h)){var D=document.createElementNS(R,"path"),I,T=h;if(v){var F=h-y,_=f(M,F),j=F<0,B,z;j?(T=y,B="0px",z=-_+"px"):(B=_+"px",z="0px");var U=f(M,T);D.setAttribute("stroke-dasharray",U+"px "+U+"px"),D.setAttribute("stroke-dashoffset",B),p(D,"stroke-dashoffset","CSS",B,z,v),l&&0===h&&p(D,"stroke-linecap","CSS","round","butt",v),A&&A!==b&&(p(D,"stroke","CSS",A,b,v),w||(E.style.stroke=A,p(E,"stroke","CSS",A,b,v)))}var W=i(T),K=100===T?-1e-5:Math.sin(W)*M,V=Math.cos(W-Math.PI)*M,L=T>50?"1":"0",G="1",Y=-M,Q="M0,"+Y;if(Q+=" A"+M+","+M+" 0 "+L+","+G+" "+K+","+V,D.setAttribute("d",Q),D.style.fill="none","string"==typeof b&&(D.style.stroke=b),D.style.strokeWidth=O,D.style.strokeLinecap=l&&h>0?"round":"butt",S){var X=S.clockwise===!1,q="string"==typeof S?S:"string"==typeof S.duration?S.duration:"1s";I=document.createElementNS(R,"animateTransform"),I.setAttribute("attributeName","transform"),I.setAttribute("attributeType","XML"),I.setAttribute("type","rotate"),I.setAttribute("from","0"),I.setAttribute("to",X?"-360":"360"),I.setAttribute("dur",q),I.setAttribute("repeatDur","indefinite"),D.appendChild(I)}D.setAttribute("class",m),e.appendChild(D)}}else{var H=document.createElementNS(R,"circle");H.setAttribute("cx",0),H.setAttribute("cy",0),H.setAttribute("r",M),H.style.stroke=b,H.style.strokeWidth=O,H.style.fill="none",H.setAttribute("class",m),e.appendChild(H)}}function m(e,t){var n;if("string"==typeof t.valueData){if(n=e.data(t.valueData),"undefined"!=typeof t.valueAttr||"undefined"!=typeof t.valueSelector)throw"options 'valueData', 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least two must be undefined!"}else{if("undefined"!=typeof t.valueData)throw"option 'valueData' is not of type 'string'!";if("string"==typeof t.valueAttr){if(n=e.attr(t.valueAttr),"undefined"!=typeof t.valueSelector)throw"options 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least one must be undefined!"}else{if("undefined"!=typeof t.valueAttr)throw"option 'valueAttr' is not of type 'string'!";"undefined"!=typeof t.valueSelector&&(n=$(t.valueSelector,e).text())}}return"undefined"==typeof n&&(n=e.text()),n}function h(e,t){return Math.max(0,Math.min(100,t.valueAdapter(e)))}function y(e,t){var n=t.mode,r=t.color,o=typeof r;if("undefined"!==o&&"string"!==o&&"function"!==o)throw"option 'color' has to be either a function or a string, but is of type '"+o+"'!";return"function"===o?n=w.USER_COLOR_FUNC:("undefined"===o&&"string"==typeof t.colorAttr&&(r=e.attr(t.colorAttr)),"string"==typeof r?n=w.USER_COLOR_CONST:"string"==typeof t.colorFunctionAttr&&(r=e.attr(t.colorFunctionAttr),"string"==typeof r&&(n=w.DATA_ATTR_FUNC))),{mode:n,color:r}}function b(e,t,n){return e===w.CSS?void 0:e===w.MASK?w.MASK.color:e===w.IMASK?w.IMASK.color:e===w.GREY?w.GREY.color:e===w.GREEN?N.colorByPercent(100):e===w.RED?N.colorByPercent(0):e===w.COLOR||void 0===t?N.colorByPercent(n):e===w.USER_COLOR_CONST?t:e===w.USER_COLOR_FUNC?t(n):e===w.DATA_ATTR_FUNC?a(t,n):"black"}function A(e,t,n){return e===w.CSS?void 0:"string"==typeof t.backgroundColor?t.backgroundColor:"function"==typeof t.backgroundColor?t.backgroundColor(n):e===w.IMASK?w.MASK.color:"none"}function v(e,t){return"undefined"==typeof e.ringWidth||t&&t.fullSize}function S(e,t,n,o,i,a){var s=document.createElementNS(R,"rect");e.appendChild(s);var u=t+r(n,3),l=t+r(n,0),d=u+t+r(n,1),f=l+t+r(n,2);"number"==typeof a&&"none"!==o&&(s.setAttribute("stroke-width",a),d-=a,f-=a,u-=a/2,l-=a/2),s.setAttribute("x","-"+u),s.setAttribute("y","-"+l),s.setAttribute("width",d),s.setAttribute("height",f),s.setAttribute("stroke",o),s.setAttribute("fill",i)}function C(e,t){var n=document.createElementNS(R,"svg"),r=e+t.getPadding(3)+t.getMargin(3),o=e+t.getPadding(0)+t.getMargin(0),i=r+e+t.getPadding(1)+t.getMargin(1),a=o+e+t.getPadding(2)+t.getMargin(2),s=i,u=a;return"number"==typeof t.scale&&(s*=t.scale,u*=t.scale),n.setAttribute("width",Math.ceil(s)),n.setAttribute("height",Math.ceil(u)),n.setAttribute("viewBox","-"+r+" -"+o+" "+i+" "+a),n}var k={getMargin:function(e){return r(this.margin,e)},getPadding:function(e){return r(this.padding,e)}},P=$.extend({},$.fn.progressPie.defaults,n,k),M="undefined"==typeof n,R="http://www.w3.org/2000/svg",E="jQuery.fn.progressPie.contentPlugin",N=$.fn.progressPie,w=$.extend({USER_COLOR_CONST:{},USER_COLOR_FUNC:{},DATA_ATTR_FUNC:{}},N.Mode);return $(this).each(function(){var t=$(this),n=P;if(M){var r=$(this).data(e);"object"==typeof r&&(n=$.extend({},r,k))}var i=$("svg",t);if(!i.length||n.update){i.length&&n.update&&(i.remove(),n.separator="");var a=m(t,n),s=h(a,n),f=t.data(N.prevValueDataName),p="undefined"==typeof f;if(t.data(N.prevValueDataName,s),"number"!=typeof f&&(f=0),"function"==typeof n.optionsByPercent){var c=n.optionsByPercent(s);"undefined"!=typeof c&&null!==c&&(n=$.extend({},n,c),a=m(t,n),s=h(a,n))}var E=Math.ceil("number"==typeof n.size?n.size:t.height());0===E&&(E=20),E*=n.sizeFactor;var w=E/2,x=w,O=y(t,n),D=b(O.mode,O.color,s),I=A(O.mode,n,s),T;(n.animateColor===!0||"undefined"==typeof n.animateColor&&!p)&&(T=b(O.mode,O.color,f));var F=N.smilSupported()?n.animate===!0?N.defaultAnimationAttributes:"object"==typeof n.animate?$.extend({},N.defaultAnimationAttributes,n.animate):null:null,_=null,j=!1;if(n.contentPlugin){_=l(n.contentPlugin);for(var B={color:D,percentValue:s,rawValue:a,pieOpts:n},z=0;z<_.length;z++){var U=_[z],W=d(n.contentPluginOptions,z),K=B;null!==W&&"object"==typeof W&&(K=$.extend({},B,W)),"object"==typeof U&&"function"==typeof U.hidesChartIfFullSize&&(j=j||n.mode!==N.Mode.MASK&&n.mode!==N.Mode.IMASK&&v(n,W)&&U.hidesChartIfFullSize(K))}}var V=C(w,n),L=document.createElementNS(R,"defs");O.mode!==N.Mode.CSS&&(V.style.verticalAlign=n.verticalAlign),t.is(":empty")?t.append(V):n.prepend?t.prepend(V,n.separator):t.append(n.separator,V);var G=null,Y=V;if(!j){n.mode!==N.Mode.MASK&&n.mode!==N.Mode.IMASK||(Y=document.createElementNS(R,"mask"),L.appendChild(Y),G=o("pie"),Y.setAttribute("id",G),n.mode===N.Mode.IMASK&&S(Y,w,n.padding,"none",I));var Q=n.cssClassForegroundPie,X=n.cssClassBackgroundCircle;"object"==typeof n.inner&&(Q+=" "+n.cssClassOuter,X+=" "+n.cssClassOuter),g(Y,w,n.strokeWidth,n.strokeColor,n.strokeDashes,I,n.overlap,n.ringWidth,n.ringEndsRounded,n.ringAlign,X,Q,s,f,D,T,F,n.rotation)}for(var q="number"==typeof n.ringWidth?n.ringWidth:"number"==typeof n.strokeWidth?n.strokeWidth:0,H=n.inner,J=1;"object"==typeof H;){"undefined"==typeof H.valueAdapter&&(H.valueAdapter=N.defaults.valueAdapter),"undefined"==typeof H.overlap&&(H.overlap=N.defaults.overlap),"undefined"==typeof H.ringAlign&&(H.ringAlign=n.ringAlign),a=m(t,H),s=h(a,H);var Z=N.prevInnerValueDataName,ee=n.cssClassInner;J>1&&(Z+=J,ee+=J),f=t.data(Z),p="undefined"==typeof f,t.data(Z,s),"number"!=typeof f&&(f=0),O=y(t,H),w="number"==typeof H.size?H.size*n.sizeFactor/2:.6*w,D=b(O.mode,O.color,s),T=null,(H.animateColor===!0||"undefined"==typeof H.animateColor&&(n.animateColor===!0||"undefined"==typeof n.animateColor&&p))&&(T=b(O.mode,O.color,f)),H.animate!==!1&&N.smilSupported()?H.animate===!0&&null===F?F=N.defaultAnimationAttributes:"object"==typeof H.animate&&(F=null===F?$.extend({},N.defaultAnimationAttributes,H.animate):$.extend({},F,H.animate)):F=null,j||g(Y,w,H.strokeWidth,H.strokeColor,H.strokeDashes,I,H.overlap,H.ringWidth,H.ringEndsRounded,H.ringAlign,n.cssClassBackgroundCircle+" "+ee,n.cssClassForegroundPie+" "+ee,s,f,D,T,F),q="number"==typeof H.ringWidth?H.ringWidth:0,H=H.inner,J++}if(null!==_){var te=w;q<w&&(te-=q);for(var ne={newSvgElement:function(e){var t=document.createElementNS(R,e);return ae.appendChild(t),t},newSvgSubelement:function(e,t){var n=document.createElementNS(R,t);return e.appendChild(n),n},newDefElement:function(e){var t=document.createElementNS(R,e);return L.appendChild(t),t},createId:o,isFullSize:function(){return v(n,this)},getBackgroundRadius:function(e){var t=this.isFullSize()?this.totalRadius:this.radius;if(!e){var n="number"==typeof this.margin?this.margin:this.isFullSize()?this.pieOpts.defaultContentPluginBackgroundMarginFullSize:this.pieOpts.defaultContentPluginBackgroundMarginInsideRing;t-=n}return t},addBackground:function(e){if(this.backgroundColor){var t=this.newSvgElement("circle");t.setAttribute("cx","0"),t.setAttribute("cy","0"),t.setAttribute("r",e),t.setAttribute("fill",this.backgroundColor)}},addBackgroundRect:function(e,t,r){S(ae,x,n.padding,e,t,r)},getContentPlugin:u,radius:te,totalRadius:x,color:D,percentValue:s,rawValue:a,pieOpts:n},re=!0,oe=0;oe<_.length;oe++){var ie=_[oe],ae=document.createElementNS(R,"g"),se="function"==typeof ie?ie:ie.draw,ue=ne,le=d(n.contentPluginOptions,oe);null!==le&&"object"==typeof le&&(ue=$.extend({},ne,le)),se(ue),"boolean"==typeof ie.inBackground&&ie.inBackground||"function"==typeof ie.inBackground&&ie.inBackground(ue)?($(V).prepend(ae),null!==G&&re&&(ae.setAttribute("mask","url(#"+G+")"),re=!1)):$(V).append(ae),L.hasChildNodes()&&$(V).prepend(L)}if(null!==G&&re)throw"MASK mode could not be applied since no content plug-in drew a background to be masked! You need do specify at least one content plug-in which draws into the background!"}}}),this},$.fn.progressPie.Mode={GREY:{color:"#888"},RED:{value:200},GREEN:{value:200},COLOR:{},CSS:{},MASK:{color:"white"},IMASK:{color:"black"}},$.fn.progressPie.colorByPercent=function(e,t){var n=$.fn.progressPie.Mode.GREEN.value,r=$.fn.progressPie.Mode.RED.value,o=e>50?n:Math.floor(n*e/50),i=e<50?r:Math.floor(r*(100-e)/50),a=i+","+o+",0";return"number"==typeof t?"rgba("+a+","+t+")":"rgb("+a+")"},$.fn.progressPie.smilSupported=function(){return"undefined"==typeof $.fn.progressPie.smilSupported.cache&&($.fn.progressPie.smilSupported.cache=/SVGAnimate/.test(document.createElementNS("http://www.w3.org/2000/svg","animate").toString())),$.fn.progressPie.smilSupported.cache},$.fn.progressPie.RingAlign={OUTER:{},CENTER:{},INNER:{}},$.fn.progressPie.defaults={mode:$.fn.progressPie.Mode.GREY,margin:0,padding:0,strokeWidth:2,overlap:!0,ringAlign:$.fn.progressPie.RingAlign.OUTER,prepend:!0,separator:"&nbsp;",verticalAlign:"bottom",update:!1,valueAdapter:function(e){return"string"==typeof e?parseFloat(e):"number"==typeof e?e:0},ringEndsRounded:!1,sizeFactor:1,scale:1,defaultContentPluginBackgroundMarginFullSize:0,defaultContentPluginBackgroundMarginInsideRing:1,cssClassBackgroundCircle:"progresspie-background",cssClassForegroundPie:"progresspie-foreground",cssClassOuter:"progresspie-outer",cssClassInner:"progresspie-inner"},$.fn.progressPie.defaultAnimationAttributes={dur:"1s",calcMode:"spline",keySplines:"0.23 1 0.32 1",keyTimes:"0;1"},$.fn.progressPie.contentPlugin={},$.fn.progressPie.prevValueDataName="_progresspieSVG_prevValue",$.fn.progressPie.prevInnerValueDataName="_progresspieSVG_prevInnerValue"}(jQuery);
/**
 * @license 
 * Copyright (c) 2016, Immo Schulz-Gerlach, www.isg-software.de 
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are 
 * permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT 
 * SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, 
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED 
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; 
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
!function($){"use strict";var t="$.fn.setupProgressPie";$.fn.setupProgressPie=function(e){return $(this).each(function(){var n=$(this).data(t);if("object"!=typeof n){var r=$.extend({},$.fn.progressPie.defaults,{update:!0},e);$(this).data(t,r)}else $.extend(n,e)}),this},$.fn.progressPie=function(e){function n(t){return.02*Math.PI*t}function r(t,e){var n=eval,r=n(t);if("function"==typeof r)return r(e);throw"The value of the colorFunctionAttr attribute is NOT a function: "+t}function i(t){var e=eval,n=e(h+"."+t);if("function"==typeof n)return n;throw t+" is not the name of a function in namespace "+h+"!"}function o(t){var e;if("function"==typeof t)e=t;else{if("string"!=typeof t)throw"contentPlugin option must either be a function or the name of a function in the namespace "+h+"!";e=i(t)}return e}function a(t,e){return.02*Math.PI*t*e}function u(t,e,r,i,o,u,s,l,f){"number"==typeof r&&(r=Math.min(r,e)),"number"==typeof o&&(o=Math.min(o,e));var d;(100>s||o&&o>0&&r>o)&&(d=document.createElementNS(g,"circle"),d.setAttribute("cx",0),d.setAttribute("cy",0),d.setAttribute("r",e-r/2),d.style.stroke="string"==typeof i?i:l,d.style.strokeWidth=r,d.style.fill="none",t.appendChild(d));var c=o?o:e,p=e-c/2;if(100===s&&(d=document.createElementNS(g,"circle"),d.setAttribute("cx",0),d.setAttribute("cy",0),d.setAttribute("r",p),d.style.stroke=l,d.style.strokeWidth=c,d.style.fill=o?"none":l,t.appendChild(d)),s>0&&100>s){var h=document.createElementNS(g,"path"),v=n(s),y=Math.sin(v)*p,b=Math.cos(v-Math.PI)*p,m=s>50?"1":"0",A="1",P=-p,R="M0,"+P;R+=" A"+p+","+p+" 0 "+m+","+A+" "+y+","+b,h.setAttribute("d",R),h.style.fill="none",h.style.stroke=l,h.style.strokeWidth=c,h.style.strokeLinecap=u?"round":"none";var C,E;if(f){var S=f.clockwise===!1;E="string"==typeof f?f:"string"==typeof f.duration?f.duration:"1s",C=document.createElementNS(g,"animateTransform"),C.setAttribute("attributeName","transform"),C.setAttribute("attributeType","XML"),C.setAttribute("type","rotate"),C.setAttribute("from","0"),C.setAttribute("to",S?"-360":"360"),C.setAttribute("dur",E),C.setAttribute("repeatDur","indefinite"),h.appendChild(C)}if(!0){E="1s";var k=a(p,s),M=k+"px",O="0px";h.setAttribute("stroke-dasharray",k+"px "+k+"px"),h.setAttribute("stroke-dashoffset","0px"),C=document.createElementNS(g,"animate"),C.setAttribute("attributeName","stroke-dashoffset"),C.setAttribute("from",M),C.setAttribute("to",O),C.setAttribute("dur",E),C.setAttribute("calcMode","spline"),C.setAttribute("keySplines","0.23 1 0.32 1"),C.setAttribute("keyTimes","0;1"),h.appendChild(C)}t.appendChild(h)}}function s(t,e){var n;if("string"==typeof e.valueData){if(n=t.data(e.valueData),"undefined"!=typeof e.valueAttr||"undefined"!=typeof e.valueSelector)throw"options 'valueData', 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least two must be undefined!"}else{if("undefined"!=typeof e.valueData)throw"option 'valueData' is not of type 'string'!";if("string"==typeof e.valueAttr){if(n=t.attr(e.valueAttr),"undefined"!=typeof e.valueSelector)throw"options 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least one must be undefined!"}else{if("undefined"!=typeof e.valueAttr)throw"option 'valueAttr' is not of type 'string'!";"undefined"!=typeof e.valueSelector&&(n=$(e.valueSelector,t).text())}}return"undefined"==typeof n&&(n=t.text()),n}function l(t,e){return Math.max(0,Math.min(100,e.valueAdapter(t)))}function f(t,e){var n=e.mode,r=e.color,i=typeof r;if("undefined"!==i&&"string"!==i&&"function"!==i)throw"option 'color' has to be either a function or a string, but is of type '"+i+"'!";return"function"===i?n=y.USER_COLOR_FUNC:("undefined"===i&&"string"==typeof e.colorAttr&&(r=t.attr(e.colorAttr)),"string"==typeof r?n=y.USER_COLOR_CONST:"string"==typeof e.colorFunctionAttr&&(r=t.attr(e.colorFunctionAttr),"string"==typeof r&&(n=y.DATA_ATTR_FUNC))),{mode:n,color:r}}function d(t,e,n){return t===y.GREY?y.GREY.color:t===y.GREEN?v.colorByPercent(100):t===y.RED?v.colorByPercent(0):t===y.COLOR||void 0===e?v.colorByPercent(n):t===y.USER_COLOR_CONST?e:t===y.USER_COLOR_FUNC?e(n):t===y.DATA_ATTR_FUNC?r(e,n):"black"}var c=$.extend({},$.fn.progressPie.defaults,e),p="undefined"==typeof e,g="http://www.w3.org/2000/svg",h="jQuery.fn.progressPie.contentPlugin",v=$.fn.progressPie,y=$.extend({USER_COLOR_CONST:{},USER_COLOR_FUNC:{},DATA_ATTR_FUNC:{}},v.Mode);return $(this).each(function(){var e=$(this),n=c;if(p){var r=$(this).data(t);"object"==typeof r&&(n=r)}var i=$("svg",e);if(!i.length||n.update){i.length&&n.update&&(i.remove(),n.separator="");var a=s(e,n),h=l(a,n);if("function"==typeof n.optionsByPercent){var v=n.optionsByPercent(h);"undefined"!=typeof v&&null!==v&&(n=$.extend({},n,v),a=s(e,n),h=l(a,n))}var y=f(e,n),b=Math.ceil("number"==typeof n.size?n.size:e.height());0===b&&(b=20),b*=n.sizeFactor;var m=Math.floor(b/2),A=m,P=A,R=document.createElementNS(g,"svg"),C=b;"number"==typeof n.scale&&(C*=n.scale),R.setAttribute("width",C),R.setAttribute("height",C),R.setAttribute("viewBox","-"+A+" -"+A+" "+b+" "+b),R.style.verticalAlign=n.verticalAlign,n.prepend?e.prepend(R,n.separator):e.append(n.separator,R);var E=d(y.mode,y.color,h);u(R,A,n.strokeWidth,n.strokeColor,n.ringWidth,n.ringEndsRounded,h,E,n.rotation);var S="number"==typeof n.ringWidth?n.ringWidth:"number"==typeof n.strokeWidth?n.strokeWidth:0;if("object"==typeof n.inner&&("undefined"==typeof n.inner.valueAdapter&&(n.inner.valueAdapter=$.fn.progressPie.defaults.valueAdapter),a=s(e,n.inner),h=l(a,n.inner),y=f(e,n.inner),A=Math.floor("number"==typeof n.inner.size?n.inner.size*n.sizeFactor/2:.6*A),E=d(y.mode,y.color,h),u(R,A,0,void 0,n.inner.ringWidth,n.inner.ringEndsRounded,h,E),S="number"==typeof n.inner.ringWidth?n.inner.ringWidth:0),n.contentPlugin){var k=o(n.contentPlugin),M=A;A>S&&(M-=S);var O={newSvgElement:function(t){var e=document.createElementNS(g,t);return R.appendChild(e),e},newSvgSubelement:function(t,e){var n=document.createElementNS(g,e);return t.appendChild(n),n},getBackgroundRadius:function(t){var e="undefined"==typeof this.pieOpts.ringWidth||this.fullSize,n=e?this.totalRadius:this.radius;if(!t){var r="number"==typeof this.margin?this.margin:e?this.pieOpts.defaultContentPluginBackgroundMarginFullSize:this.pieOpts.defaultContentPluginBackgroundMarginInsideRing;n-=r}return n},addBackground:function(t){if(this.backgroundColor){var e=this.newSvgElement("circle");e.setAttribute("cx","0"),e.setAttribute("cy","0"),e.setAttribute("r",t),e.setAttribute("fill",this.backgroundColor)}},getContentPlugin:o,radius:M,totalRadius:P,color:E,percentValue:h,rawValue:a,pieOpts:n};"object"==typeof n.contentPluginOptions&&$.extend(O,n.contentPluginOptions),k(O)}}}),this},$.fn.progressPie.Mode={GREY:{color:"#888"},RED:{value:200},GREEN:{value:200},COLOR:{}},$.fn.progressPie.colorByPercent=function(t){var e=$.fn.progressPie.Mode.GREEN.value,n=$.fn.progressPie.Mode.RED.value,r=t>50?e:Math.floor(e*t/50),i=50>t?n:Math.floor(n*(100-t)/50);return"rgb("+i+","+r+",0)"},$.fn.progressPie.defaults={mode:$.fn.progressPie.Mode.GREY,strokeWidth:2,prepend:!0,separator:"&nbsp;",verticalAlign:"bottom",update:!1,valueAdapter:function(t){return"string"==typeof t?parseInt(t):"number"==typeof t?t:0},ringEndsRounded:!1,sizeFactor:1,scale:1,defaultContentPluginBackgroundMarginFullSize:0,defaultContentPluginBackgroundMarginInsideRing:1},$.fn.progressPie.contentPlugin={}}(jQuery);
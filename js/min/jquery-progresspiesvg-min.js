/**
 * @license 
 * Copyright (c) 2016, Immo Schulz-Gerlach, www.isg-software.de 
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are 
 * permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT 
 * SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, 
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED 
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; 
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
!function($){"use strict";var e="$.fn.setupProgressPie";$.fn.setupProgressPie=function(t){return $(this).each(function(){var n=$(this).data(e);if("object"!=typeof n){var r=$.extend({},$.fn.progressPie.defaults,{update:!0},t);$(this).data(e,r)}else $.extend(n,t)}),this},$.fn.progressPie=function(t){function n(e){return.02*Math.PI*e}function r(e,t){var n=eval,r=n(e);if("function"==typeof r)return r(t);throw"The value of the colorFunctionAttr attribute is NOT a function: "+e}function i(e){var t=eval,n=t(h+"."+e);if("function"==typeof n)return n;throw e+" is not the name of a function in namespace "+h+"!"}function o(e){var t;if("function"==typeof e)t=e;else{if("string"!=typeof e)throw"contentPlugin option must either be a function or the name of a function in the namespace "+h+"!";t=i(e)}return t}function a(e,t){return.02*Math.PI*e*t}function u(){return"undefined"==typeof u.cache&&(u.cache=/SVGAnimate/.test(document.createElementNS("http://www.w3.org/2000/svg","animate").toString())),u.cache}function s(e,t,r,i,o,u,s,l,f,d,p,c){"number"==typeof r&&(r=Math.min(r,t)),"number"==typeof o&&(o=Math.min(o,t));var g;(100>s||o&&o>0&&r>o||p)&&(g=document.createElementNS(m,"circle"),g.setAttribute("cx",0),g.setAttribute("cy",0),g.setAttribute("r",t-r/2),g.style.stroke="string"==typeof i?i:f,g.style.strokeWidth=r,g.style.fill="none",e.appendChild(g));var h=o?o:t,v=t-h/2;if(100!==s||p){if(s>0&&100>s||p&&(0===s||100===s)){var y=document.createElementNS(m,"path"),b,A=s;if(p){var P=s-l,S=a(v,P),C=0>P,E,R;C?(A=l,E="0px",R=-S+"px"):(E=S+"px",R="0px");var N=a(v,A);y.setAttribute("stroke-dasharray",N+"px "+N+"px"),y.setAttribute("stroke-dashoffset",E),b=document.createElementNS(m,"animate"),b.setAttribute("attributeName","stroke-dashoffset"),b.setAttribute("attributeType","CSS"),b.setAttribute("from",E),b.setAttribute("to",R),b.setAttribute("fill","freeze");for(var k in p)b.setAttribute(k,p[k]);if(y.appendChild(b),u&&0===s){b=document.createElementNS(m,"animate"),b.setAttribute("attributeName","stroke-linecap"),b.setAttribute("attributeType","CSS"),b.setAttribute("from","round"),b.setAttribute("to","butt");for(k in p)b.setAttribute(k,p[k]);y.appendChild(b)}if(d&&d!==f){b=document.createElementNS(m,"animate"),b.setAttribute("attributeName","stroke"),b.setAttribute("attributeType","CSS"),b.setAttribute("from",d),b.setAttribute("to",f);for(k in p)b.setAttribute(k,p[k]);y.appendChild(b)}}var M=n(A),O=100===A?-1e-5:Math.sin(M)*v,w=Math.cos(M-Math.PI)*v,x=A>50?"1":"0",_="1",T=-v,D="M0,"+T;if(D+=" A"+v+","+v+" 0 "+x+","+_+" "+O+","+w,y.setAttribute("d",D),y.style.fill="none",y.style.stroke=f,y.style.strokeWidth=h,y.style.strokeLinecap=u&&s>0?"round":"butt",c){var F=c.clockwise===!1,W="string"==typeof c?c:"string"==typeof c.duration?c.duration:"1s";b=document.createElementNS(m,"animateTransform"),b.setAttribute("attributeName","transform"),b.setAttribute("attributeType","XML"),b.setAttribute("type","rotate"),b.setAttribute("from","0"),b.setAttribute("to",F?"-360":"360"),b.setAttribute("dur",W),b.setAttribute("repeatDur","indefinite"),y.appendChild(b)}e.appendChild(y)}}else g=document.createElementNS(m,"circle"),g.setAttribute("cx",0),g.setAttribute("cy",0),g.setAttribute("r",v),g.style.stroke=f,g.style.strokeWidth=h,g.style.fill=o?"none":f,e.appendChild(g)}function l(e,t){var n;if("string"==typeof t.valueData){if(n=e.data(t.valueData),"undefined"!=typeof t.valueAttr||"undefined"!=typeof t.valueSelector)throw"options 'valueData', 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least two must be undefined!"}else{if("undefined"!=typeof t.valueData)throw"option 'valueData' is not of type 'string'!";if("string"==typeof t.valueAttr){if(n=e.attr(t.valueAttr),"undefined"!=typeof t.valueSelector)throw"options 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least one must be undefined!"}else{if("undefined"!=typeof t.valueAttr)throw"option 'valueAttr' is not of type 'string'!";"undefined"!=typeof t.valueSelector&&(n=$(t.valueSelector,e).text())}}return"undefined"==typeof n&&(n=e.text()),n}function f(e,t){return Math.max(0,Math.min(100,t.valueAdapter(e)))}function d(e,t){var n=t.mode,r=t.color,i=typeof r;if("undefined"!==i&&"string"!==i&&"function"!==i)throw"option 'color' has to be either a function or a string, but is of type '"+i+"'!";return"function"===i?n=y.USER_COLOR_FUNC:("undefined"===i&&"string"==typeof t.colorAttr&&(r=e.attr(t.colorAttr)),"string"==typeof r?n=y.USER_COLOR_CONST:"string"==typeof t.colorFunctionAttr&&(r=e.attr(t.colorFunctionAttr),"string"==typeof r&&(n=y.DATA_ATTR_FUNC))),{mode:n,color:r}}function p(e,t,n){return e===y.GREY?y.GREY.color:e===y.GREEN?v.colorByPercent(100):e===y.RED?v.colorByPercent(0):e===y.COLOR||void 0===t?v.colorByPercent(n):e===y.USER_COLOR_CONST?t:e===y.USER_COLOR_FUNC?t(n):e===y.DATA_ATTR_FUNC?r(t,n):"black"}var c=$.extend({},$.fn.progressPie.defaults,t),g="undefined"==typeof t,m="http://www.w3.org/2000/svg",h="jQuery.fn.progressPie.contentPlugin",v=$.fn.progressPie,y=$.extend({USER_COLOR_CONST:{},USER_COLOR_FUNC:{},DATA_ATTR_FUNC:{}},v.Mode);return $(this).each(function(){var t=$(this),n=c;if(g){var r=$(this).data(e);"object"==typeof r&&(n=r)}var i=$("svg",t);if(!i.length||n.update){i.length&&n.update&&(i.remove(),n.separator="");var a=l(t,n),h=f(a,n),v=t.data($.fn.progressPie.prevValueDataName);if(t.data($.fn.progressPie.prevValueDataName,h),"number"!=typeof v&&(v=0),"function"==typeof n.optionsByPercent){var y=n.optionsByPercent(h);"undefined"!=typeof y&&null!==y&&(n=$.extend({},n,y),a=l(t,n),h=f(a,n))}var b=d(t,n),A=Math.ceil("number"==typeof n.size?n.size:t.height());0===A&&(A=20),A*=n.sizeFactor;var P=Math.floor(A/2),S=P,C=S,E=document.createElementNS(m,"svg"),R=A;"number"==typeof n.scale&&(R*=n.scale),E.setAttribute("width",R),E.setAttribute("height",R),E.setAttribute("viewBox","-"+S+" -"+S+" "+A+" "+A),E.style.verticalAlign=n.verticalAlign,n.prepend?t.prepend(E,n.separator):t.append(n.separator,E);var N=p(b.mode,b.color,h),k;(n.animateColor===!0||"undefined"==typeof n.animateColor&&v>0)&&(k=p(b.mode,b.color,v));var M=u()?n.animate===!0?$.fn.progressPie.defaultAnimationAttributes:"object"==typeof n.animate?$.extend({},$.fn.progressPie.defaultAnimationAttributes,n.animate):null:null;s(E,S,n.strokeWidth,n.strokeColor,n.ringWidth,n.ringEndsRounded,h,v,N,k,M,n.rotation);var O="number"==typeof n.ringWidth?n.ringWidth:"number"==typeof n.strokeWidth?n.strokeWidth:0;if("object"==typeof n.inner&&("undefined"==typeof n.inner.valueAdapter&&(n.inner.valueAdapter=$.fn.progressPie.defaults.valueAdapter),a=l(t,n.inner),h=f(a,n.inner),v=t.data($.fn.progressPie.prevInnerValueDataName),t.data($.fn.progressPie.prevInnerValueDataName,h),"number"!=typeof v&&(v=0),b=d(t,n.inner),S=Math.floor("number"==typeof n.inner.size?n.inner.size*n.sizeFactor/2:.6*S),N=p(b.mode,b.color,h),k=null,(n.inner.animateColor===!0||"undefined"==typeof n.inner.animateColor&&(n.animateColor===!0||"undefined"==typeof n.animateColor&&v>0))&&(k=p(b.mode,b.color,v)),s(E,S,0,void 0,n.inner.ringWidth,n.inner.ringEndsRounded,h,v,N,k,M),O="number"==typeof n.inner.ringWidth?n.inner.ringWidth:0),n.contentPlugin){var w=o(n.contentPlugin),x=S;S>O&&(x-=O);var _={newSvgElement:function(e){var t=document.createElementNS(m,e);return E.appendChild(t),t},newSvgSubelement:function(e,t){var n=document.createElementNS(m,t);return e.appendChild(n),n},getBackgroundRadius:function(e){var t="undefined"==typeof this.pieOpts.ringWidth||this.fullSize,n=t?this.totalRadius:this.radius;if(!e){var r="number"==typeof this.margin?this.margin:t?this.pieOpts.defaultContentPluginBackgroundMarginFullSize:this.pieOpts.defaultContentPluginBackgroundMarginInsideRing;n-=r}return n},addBackground:function(e){if(this.backgroundColor){var t=this.newSvgElement("circle");t.setAttribute("cx","0"),t.setAttribute("cy","0"),t.setAttribute("r",e),t.setAttribute("fill",this.backgroundColor)}},getContentPlugin:o,radius:x,totalRadius:C,color:N,percentValue:h,rawValue:a,pieOpts:n};"object"==typeof n.contentPluginOptions&&$.extend(_,n.contentPluginOptions),w(_)}}}),this},$.fn.progressPie.Mode={GREY:{color:"#888"},RED:{value:200},GREEN:{value:200},COLOR:{}},$.fn.progressPie.colorByPercent=function(e){var t=$.fn.progressPie.Mode.GREEN.value,n=$.fn.progressPie.Mode.RED.value,r=e>50?t:Math.floor(t*e/50),i=50>e?n:Math.floor(n*(100-e)/50);return"rgb("+i+","+r+",0)"},$.fn.progressPie.defaults={mode:$.fn.progressPie.Mode.GREY,strokeWidth:2,prepend:!0,separator:"&nbsp;",verticalAlign:"bottom",update:!1,valueAdapter:function(e){return"string"==typeof e?parseInt(e):"number"==typeof e?e:0},ringEndsRounded:!1,sizeFactor:1,scale:1,defaultContentPluginBackgroundMarginFullSize:0,defaultContentPluginBackgroundMarginInsideRing:1},$.fn.progressPie.defaultAnimationAttributes={dur:"1s",calcMode:"spline",keySplines:"0.23 1 0.32 1",keyTimes:"0;1"},$.fn.progressPie.contentPlugin={},$.fn.progressPie.prevValueDataName="_progresspieSVG_prevValue",$.fn.progressPie.prevInnerValueDataName="_progresspieSVG_prevInnerValue"}(jQuery);
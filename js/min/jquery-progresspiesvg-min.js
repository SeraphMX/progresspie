/**
 * @license 
 * Copyright (c) 2016, Immo Schulz-Gerlach, www.isg-software.de 
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are 
 * permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT 
 * SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, 
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED 
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; 
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
!function($){"use strict";var e="$.fn.setupProgressPie",t={};$.fn.setupProgressPie=function(t){return $(this).each(function(){var r=$(this).data(e);if("object"!=typeof r){var n=$.extend({},$.fn.progressPie.defaults,{update:!0},t);$(this).data(e,n)}else $.extend(r,t)}),this},$.fn.progressPie=function(r){function n(e){return"undefined"==typeof t[e]&&(t[e]=0),e+ ++t[e]}function o(e){return.02*Math.PI*e}function i(e,t){var r=eval,n=r(e);if("function"==typeof n)return n(t);throw"The value of the colorFunctionAttr attribute is NOT a function: "+e}function a(e){var t=eval,r=t(k+"."+e);if("function"==typeof r||"object"==typeof r&&"function"==typeof r.draw)return r;throw e+" is not the name of a function or object in namespace "+k+"!"}function s(e){var t;if("function"==typeof e||"object"==typeof e&&"function"==typeof e.draw)t=e;else{if("string"!=typeof e)throw"contentPlugin option must either be a function or an object with method named 'draw' or the name of such a function or object in the namespace "+k+"!";t=a(e)}return t}function u(e){return Array.isArray(e)?$.map(e,s):[s(e)]}function l(e,t){return null===e?null:Array.isArray(e)?e[t]:0===t&&"object"==typeof e?e:null}function f(e,t){return.02*Math.PI*e*t}function d(e,t,r,n,o,i){var a=document.createElementNS(C,"animate");a.setAttribute("attributeName",t),a.setAttribute("attributeType",r),a.setAttribute("from",n),a.setAttribute("to",o),a.setAttribute("fill","freeze");for(var s in i)a.setAttribute(s,i[s]);e.appendChild(a)}function p(e,t,r){var n,o;if("number"==typeof t)n=t;else{if("object"!=typeof t)throw"illegal option: 'strokeDashes' is neither number (count) nor object!";n=t.count,o=t.length}if("undefined"==typeof n)throw"illegal option: 'strokeDashes' does not specify the 'count' property!";if("undefined"==typeof o)o=r/n/2;else if("string"==typeof o){o=o.trim();var i="%"===o.substring(o.length-1);o=Number.parseInt(o,10),i&&(o=r*o/100)}if(o*n>=r)throw"Illegal options: strokeDashCount * strokeDashLength >= circumference, can't set stroke-dasharray!";var a=(r-o*n)/n,s="object"==typeof t&&t.centered?1*o/2:0;"object"==typeof t&&t.inverted?(e.style.strokeDasharray=""+a+"px, "+o+"px",e.style.strokeDashoffset=""+(a+s)+"px"):(e.style.strokeDasharray=""+o+"px, "+a+"px",0!==s&&(e.style.strokeDashoffset=""+s+"px"))}function c(e,t,r,n,i,a,s,u,l,c,g,y,m,h,v,b,A){"number"==typeof r&&(r=Math.min(r,t)),"number"==typeof u&&(u=Math.min(u,t));var S,k,P=!1;if("number"==typeof r){k=document.createElementNS(C,"circle"),k.setAttribute("cx",0),k.setAttribute("cy",0),S=t-r/2,k.setAttribute("r",S),k.setAttribute("transform","rotate(-90)"),i&&p(k,i,2*Math.PI*S),P="string"==typeof n;var E=P?n:h;"string"==typeof E&&(k.style.stroke=E),"string"==typeof a&&(k.style.fill=a),k.style.strokeWidth=r,k.setAttribute("class",c),e.appendChild(k)}var M=u?u:s||"number"!=typeof r?t:t-r;if(S=t-M/2,s||"number"!=typeof r||(S-=r),100!==y||b||"string"!=typeof h){if(y>0&&y<100||(b||"undefined"==typeof h)&&(0===y||100===y)){var w=document.createElementNS(C,"path"),N,R=y;if(b){var x=y-m,O=f(S,x),D=x<0,F,_;D?(R=m,F="0px",_=-O+"px"):(F=O+"px",_="0px");var j=f(S,R);w.setAttribute("stroke-dasharray",j+"px "+j+"px"),w.setAttribute("stroke-dashoffset",F),d(w,"stroke-dashoffset","CSS",F,_,b),l&&0===y&&d(w,"stroke-linecap","CSS","round","butt",b),v&&v!==h&&(d(w,"stroke","CSS",v,h,b),P||(k.style.stroke=v,d(k,"stroke","CSS",v,h,b)))}var B=o(R),T=100===R?-1e-5:Math.sin(B)*S,z=Math.cos(B-Math.PI)*S,I=R>50?"1":"0",W="1",V=-S,U="M0,"+V;if(U+=" A"+S+","+S+" 0 "+I+","+W+" "+T+","+z,w.setAttribute("d",U),w.style.fill="none","string"==typeof h&&(w.style.stroke=h),w.style.strokeWidth=M,w.style.strokeLinecap=l&&y>0?"round":"butt",A){var L=A.clockwise===!1,G="string"==typeof A?A:"string"==typeof A.duration?A.duration:"1s";N=document.createElementNS(C,"animateTransform"),N.setAttribute("attributeName","transform"),N.setAttribute("attributeType","XML"),N.setAttribute("type","rotate"),N.setAttribute("from","0"),N.setAttribute("to",L?"-360":"360"),N.setAttribute("dur",G),N.setAttribute("repeatDur","indefinite"),w.appendChild(N)}w.setAttribute("class",g),e.appendChild(w)}}else{var K=document.createElementNS(C,"circle");K.setAttribute("cx",0),K.setAttribute("cy",0),K.setAttribute("r",S),K.style.stroke=h,K.style.strokeWidth=M,K.style.fill="none",K.setAttribute("class",g),e.appendChild(K)}}function g(e,t){var r;if("string"==typeof t.valueData){if(r=e.data(t.valueData),"undefined"!=typeof t.valueAttr||"undefined"!=typeof t.valueSelector)throw"options 'valueData', 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least two must be undefined!"}else{if("undefined"!=typeof t.valueData)throw"option 'valueData' is not of type 'string'!";if("string"==typeof t.valueAttr){if(r=e.attr(t.valueAttr),"undefined"!=typeof t.valueSelector)throw"options 'valueAttr' and 'valueSelector' are mutually exclusive, i.e. at least one must be undefined!"}else{if("undefined"!=typeof t.valueAttr)throw"option 'valueAttr' is not of type 'string'!";"undefined"!=typeof t.valueSelector&&(r=$(t.valueSelector,e).text())}}return"undefined"==typeof r&&(r=e.text()),r}function y(e,t){return Math.max(0,Math.min(100,t.valueAdapter(e)))}function m(e,t){var r=t.mode,n=t.color,o=typeof n;if("undefined"!==o&&"string"!==o&&"function"!==o)throw"option 'color' has to be either a function or a string, but is of type '"+o+"'!";return"function"===o?r=E.USER_COLOR_FUNC:("undefined"===o&&"string"==typeof t.colorAttr&&(n=e.attr(t.colorAttr)),"string"==typeof n?r=E.USER_COLOR_CONST:"string"==typeof t.colorFunctionAttr&&(n=e.attr(t.colorFunctionAttr),"string"==typeof n&&(r=E.DATA_ATTR_FUNC))),{mode:r,color:n}}function h(e,t,r){return e===E.CSS?void 0:e===E.MASK?E.MASK.color:e===E.GREY?E.GREY.color:e===E.GREEN?P.colorByPercent(100):e===E.RED?P.colorByPercent(0):e===E.COLOR||void 0===t?P.colorByPercent(r):e===E.USER_COLOR_CONST?t:e===E.USER_COLOR_FUNC?t(r):e===E.DATA_ATTR_FUNC?i(t,r):"black"}function v(e){return e===E.CSS||e===E.MASK?void 0:"none"}function b(e,t){return"undefined"==typeof e.ringWidth||t&&t.fullSize}var A=$.extend({},$.fn.progressPie.defaults,r),S="undefined"==typeof r,C="http://www.w3.org/2000/svg",k="jQuery.fn.progressPie.contentPlugin",P=$.fn.progressPie,E=$.extend({USER_COLOR_CONST:{},USER_COLOR_FUNC:{},DATA_ATTR_FUNC:{}},P.Mode);return $(this).each(function(){var t=$(this),r=A;if(S){var o=$(this).data(e);"object"==typeof o&&(r=o)}var i=$("svg",t);if(!i.length||r.update){i.length&&r.update&&(i.remove(),r.separator="");var a=g(t,r),f=y(a,r),d=t.data(P.prevValueDataName),p="undefined"==typeof d;if(t.data(P.prevValueDataName,f),"number"!=typeof d&&(d=0),"function"==typeof r.optionsByPercent){var k=r.optionsByPercent(f);"undefined"!=typeof k&&null!==k&&(r=$.extend({},r,k),a=g(t,r),f=y(a,r))}var E=m(t,r),M=Math.ceil("number"==typeof r.size?r.size:t.height());0===M&&(M=20),M*=r.sizeFactor;var w=M/2,N=w,R=N,x=document.createElementNS(C,"svg"),O=document.createElementNS(C,"defs"),D=M;"number"==typeof r.scale&&(D*=r.scale),x.setAttribute("width",Math.ceil(D)),x.setAttribute("height",Math.ceil(D)),x.setAttribute("viewBox","-"+N+" -"+N+" "+M+" "+M),E.mode!==P.Mode.CSS&&(x.style.verticalAlign=r.verticalAlign),t.is(":empty")?t.append(x):r.prepend?t.prepend(x,r.separator):t.append(r.separator,x);var F=r.cssClassForegroundPie,_=r.cssClassBackgroundCircle;"object"==typeof r.inner&&(F+=" "+r.cssClassOuter,_+=" "+r.cssClassOuter);var j=h(E.mode,E.color,f),B,T=v(E.mode);(r.animateColor===!0||"undefined"==typeof r.animateColor&&!p)&&(B=h(E.mode,E.color,d));var z=P.smilSupported()?r.animate===!0?P.defaultAnimationAttributes:"object"==typeof r.animate?$.extend({},P.defaultAnimationAttributes,r.animate):null:null,I=null,W=!1;if(r.contentPlugin){I=u(r.contentPlugin);for(var V={color:j,percentValue:f,rawValue:a,pieOpts:r},U=0;U<I.length;U++){var L=I[U],G=l(r.contentPluginOptions,U),K=V;null!==G&&"object"==typeof G&&(K=$.extend({},V,G)),"object"==typeof L&&"function"==typeof L.hidesChartIfFullSize&&(W=W||E.mode!==P.Mode.MASK&&b(r,G)&&L.hidesChartIfFullSize(K))}}var Y=null,Q=x;if(!W){if(E.mode===P.Mode.MASK){if(null===I)throw"MASK mode requires content plug-ins (in the background!)";Q=document.createElementNS(C,"mask"),O.append(Q),Y=n("pie"),Q.setAttribute("id",Y)}c(Q,N,r.strokeWidth,r.strokeColor,r.strokeDashes,T,r.overlap,r.ringWidth,r.ringEndsRounded,_,F,f,d,j,B,z,r.rotation)}for(var q="number"==typeof r.ringWidth?r.ringWidth:"number"==typeof r.strokeWidth?r.strokeWidth:0,X=r.inner,H=1;"object"==typeof X;){"undefined"==typeof X.valueAdapter&&(X.valueAdapter=P.defaults.valueAdapter),"undefined"==typeof X.overlap&&(X.overlap=P.defaults.overlap),a=g(t,X),f=y(a,X);var J=P.prevInnerValueDataName,Z=r.cssClassInner;H>1&&(J+=H,Z+=H),d=t.data(J),p="undefined"==typeof d,t.data(J,f),"number"!=typeof d&&(d=0),E=m(t,X),N="number"==typeof X.size?X.size*r.sizeFactor/2:.6*N,j=h(E.mode,E.color,f),B=null,(X.animateColor===!0||"undefined"==typeof X.animateColor&&(r.animateColor===!0||"undefined"==typeof r.animateColor&&p))&&(B=h(E.mode,E.color,d)),X.animate!==!1&&P.smilSupported()?X.animate===!0&&null===z?z=P.defaultAnimationAttributes:"object"==typeof X.animate&&(z=null===z?$.extend({},P.defaultAnimationAttributes,X.animate):$.extend({},z,X.animate)):z=null,W||c(Q,N,X.strokeWidth,X.strokeColor,X.strokeDashes,T,X.overlap,X.ringWidth,X.ringEndsRounded,r.cssClassBackgroundCircle+" "+Z,r.cssClassForegroundPie+" "+Z,f,d,j,B,z),q="number"==typeof X.ringWidth?X.ringWidth:0,X=X.inner,H++}if(null!==I){var ee=N;q<N&&(ee-=q);for(var te={newSvgElement:function(e){var t=document.createElementNS(C,e);return oe.appendChild(t),t},newSvgSubelement:function(e,t){var r=document.createElementNS(C,t);return e.appendChild(r),r},newDefElement:function(e){var t=document.createElementNS(C,e);return O.appendChild(t),t},isFullSize:function(){return b(r,this)},getBackgroundRadius:function(e){var t=this.isFullSize()?this.totalRadius:this.radius;if(!e){var r="number"==typeof this.margin?this.margin:this.isFullSize()?this.pieOpts.defaultContentPluginBackgroundMarginFullSize:this.pieOpts.defaultContentPluginBackgroundMarginInsideRing;t-=r}return t},addBackground:function(e){if(this.backgroundColor){var t=this.newSvgElement("circle");t.setAttribute("cx","0"),t.setAttribute("cy","0"),t.setAttribute("r",e),t.setAttribute("fill",this.backgroundColor)}},getContentPlugin:s,createId:n,radius:ee,totalRadius:R,color:j,percentValue:f,rawValue:a,pieOpts:r},re=0;re<I.length;re++){var ne=I[re],oe=document.createElementNS(C,"g"),ie="function"==typeof ne?ne:ne.draw,ae=te,se=l(r.contentPluginOptions,re);null!==se&&"object"==typeof se&&(ae=$.extend({},te,se)),ie(ae),"boolean"==typeof ne.inBackground&&ne.inBackground||"function"==typeof ne.inBackground&&ne.inBackground(ae)?(x.prepend(oe),null!==Y&&oe.setAttribute("mask","url(#"+Y+")")):x.append(oe),O.hasChildNodes()&&x.prepend(O)}}}}),this},$.fn.progressPie.Mode={GREY:{color:"#888"},RED:{value:200},GREEN:{value:200},COLOR:{},CSS:{},MASK:{color:"white"}},$.fn.progressPie.colorByPercent=function(e){var t=$.fn.progressPie.Mode.GREEN.value,r=$.fn.progressPie.Mode.RED.value,n=e>50?t:Math.floor(t*e/50),o=e<50?r:Math.floor(r*(100-e)/50);return"rgb("+o+","+n+",0)"},$.fn.progressPie.smilSupported=function(){return"undefined"==typeof $.fn.progressPie.smilSupported.cache&&($.fn.progressPie.smilSupported.cache=/SVGAnimate/.test(document.createElementNS("http://www.w3.org/2000/svg","animate").toString())),$.fn.progressPie.smilSupported.cache},$.fn.progressPie.defaults={mode:$.fn.progressPie.Mode.GREY,strokeWidth:2,overlap:!0,prepend:!0,separator:"&nbsp;",verticalAlign:"bottom",update:!1,valueAdapter:function(e){return"string"==typeof e?parseFloat(e):"number"==typeof e?e:0},ringEndsRounded:!1,sizeFactor:1,scale:1,defaultContentPluginBackgroundMarginFullSize:0,defaultContentPluginBackgroundMarginInsideRing:1,cssClassBackgroundCircle:"progresspie-background",cssClassForegroundPie:"progresspie-foreground",cssClassOuter:"progresspie-outer",cssClassInner:"progresspie-inner"},$.fn.progressPie.defaultAnimationAttributes={dur:"1s",calcMode:"spline",keySplines:"0.23 1 0.32 1",keyTimes:"0;1"},$.fn.progressPie.contentPlugin={},$.fn.progressPie.prevValueDataName="_progresspieSVG_prevValue",$.fn.progressPie.prevInnerValueDataName="_progresspieSVG_prevInnerValue"}(jQuery);